@page "/denonciation"
@page "/denonciation/{denonciationId:int?}"
@using API.Resources
@inject DenonciationConsultationService Service
<PageTitle>@Title</PageTitle>
	@if (denonciationId == 0)
{
	<div class="row">
		<div class="col-12">
			<h4><span class="oi oi-list"></span> @Title</h4>
		</div>
	</div>
	<div class="row">
		<div class="col-6">
			<div class="col-6">
				<button @onclick="@(() => Add())" class="btn btn-sm btnprimary">
					<span class="oi oi-plus"></span>
					Ajouter
				</button>
			</div>
		</div>
	</div>
}
else if (denonciation == null)
{
	<p><em>Aucune dénonciation ne possède cet identifiant.</em></p>
}
else
{
	<div class="row">
		<div class="col-12">
			<h4><span class="oi oi-list"></span> @Title</h4>
		</div>
	</div>
	<table class="table">
		<thead>
			<tr>
				<th>Horodatage</th>
				<th>Informateur</th>
				<th>Suspect</th>
				<th>Délit</th>
				<th>Pays d'évasion</th>
				<th>Date de réponse</th>
				<th>Statut</th>
				<th>Rétribution</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>@denonciation.Horodatage</td>
				<td>@denonciation.Informateur.Nom.Value @denonciation.Informateur.Prenom.Value</td>
				<td>@denonciation.Suspect.Nom.Value @denonciation.Suspect.Prenom.Value</td>
				<td>@denonciation.Delit</td>
				<td>@denonciation.PaysEvasion</td>
				<td>@denonciation.Reponse.Horodatage</td>
				<td>@denonciation.Reponse.Type</td>
				<td>@denonciation.Reponse.Retribution €</td>
			</tr>
		</tbody>
	</table>
}

@code {
	[Parameter] public int denonciationId { get; set; }
	private const string Title = "Dénonciation";
	private DenonciationConsultationAPI? denonciation;
	[CascadingParameter]
	public IModalService Modal { get; set; } = default!;
	protected override async Task OnInitializedAsync()
	{
		await FetchData();
	}
	private async Task FetchData()
	{
		denonciation = await Service.GetDenonciationAsync(denonciationId);
	}
	async Task Add()
	{
		var modal = Modal.Show<AjoutDenonciation>("Ajout d'une dénonciation");
		var result = await modal.Result;
		if (!result.Cancelled)
		{
			await FetchData();
		}
	}
}